# tool 実装確認チェックリスト（仕様書ベース）

- 作成日: 2026-02-07
- 対象仕様:
  - `docs/tool_rebuild_requirements.md`（本書 第4章, 第9章, 第12章）
  - `docs/tool_as_is_spec.md`
  - `docs/terminology_glossary.md`
- 対象画面/実装: `tool.html`, `js/script.js`, `css/style.css`, `manual.html`

## 0. 実施情報

- 確認者:
- 確認日:
- 対象コミット/ブランチ:
- 使用データ:
  - アンケート:
  - シフト:
- チェック運用:
  - `[x]`: 実施済み
  - `[ ]`: 未実施

## 1. 機能要件チェック（FR-001〜FR-012）

- [x] FR-001 画面互換: STEP1〜4構成、主要ID、タブ構成が維持されている
- [x] FR-002 ファイル読込: Excel/CSV 1シート目読込、成功/失敗ステータス表示
- [x] FR-003 シフト解析: ヘッダー探索、メタ列除外、`（N人体制）` 解析、土日祝判定
- [x] FR-004 アンケート列認識: 必要列（回数/希望/NG/場所/追加/氏名系）へマッピング
- [x] FR-005 場所整合性: `baseName` 基準で突合、不一致時は割当実行不可
- [x] FR-006 参加者生成: 除外条件（空行/0/免除）と回数解析が仕様どおり
- [x] FR-007 スロット生成: 非土日祝対象、定員展開、プレ割当保持
- [x] FR-008 共通制約: 同日重複/前後NG/NG日曜月/希望条件が適用される
- [x] FR-009 ロジック選択: 4ロジックが選択可能で、共通制約を利用
- [x] FR-010 結果表示: サマリー + 4タブ + 0回参加者表示
- [x] FR-011 Excel出力: ファイル名/3シート/画面整合が仕様どおり
- [ ] FR-012 削除禁止機能: `tool_as_is_spec.md` 第10章の機能が維持されている

## 2. 追加UX要件チェック（FR-013〜FR-019）

- [x] FR-013 不足タグナビ: 必須不足/重複のナビ表示、クリック移動、ハイライト
- [x] FR-014 マッピング確定: 確定前後の状態遷移、STEP2/3開放条件が仕様どおり
- [x] FR-015 未対応列フィルタ: `UNMAPPED` のみ表示/全表示、0件時空状態表示
- [x] FR-016 割当実行無効理由: `assignBtn` 無効理由が常時表示され即時更新
- [x] FR-017 D&D読込: 2つのアップロード枠で drop 読込、非対応拡張子エラー
- [x] FR-018 前回マッピング復元: `localStorage` 保存/互換判定/復元提示/不一致時抑止
- [x] FR-019 用語統一: `tool.html` と `manual.html` の表示語が用語集と一致

## 3. 非機能要件チェック（NFR）

- [ ] NFR-001 保守性: ロジックとDOM操作が分離され、責務が明確
- [x] NFR-002 可読性: 4スペース、`const/let`、セミコロン、命名が統一
- [ ] NFR-003 性能: 体感で操作不能がない（想定データ規模で確認）
- [ ] NFR-004 信頼性: 例外時にUIが固まらず、原因が分かるメッセージが出る
- [ ] NFR-005 デザイン互換: 緑系テーマ/カード/タブ/モバイル崩れ抑制

## 4. 受け入れ試験チェック（UAT-01〜UAT-14）

- [ ] UAT-01 機能同等（削除禁止機能が動作）
- [ ] UAT-02 主要フロー（読込→プレビュー→割当→4タブ→Excel出力）
- [ ] UAT-03 再割当（既存入力セル保持 + 空欄補完）
- [ ] UAT-04 複数人体制（展開/表示/出力一致）
- [ ] UAT-05 NG期間（0で無効、>0で有効）
- [ ] UAT-06 列認識（監査対象項目が意図どおり）
- [ ] UAT-07 出力整合（画面とExcelの集計一致）
- [ ] UAT-08 不足タグナビ（表示/移動/ハイライト）
- [ ] UAT-09 マッピング確定（確定前後の制御）
- [ ] UAT-10 未対応列フィルタ（ON/OFF/空状態）
- [ ] UAT-11 割当ボタン無効理由（表示/即時更新）
- [ ] UAT-12 D&D（読込成功/エラー/既存選択維持）
- [ ] UAT-13 自動復元（同形式復元/不一致抑止/本文未保存）
- [ ] UAT-14 用語統一（`tool.html` と `manual.html` 一致）

## 5. 証跡

- [ ] スクリーンショット（主要画面、エラー表示、結果4タブ）
- [ ] 出力Excel（検証時ファイル）
- [ ] 使用入力ファイル（再現用）
- [ ] 実行ログ（必要に応じて）

## 6. 判定

- [ ] すべて合格（リリース可）
- [x] 条件付き合格（要フォローあり）
- [ ] 不合格（要修正）

### フォロー事項

1.
2.
3.

## 7. 実施結果（2026-02-07）

### 7.1 実施条件

- 確認者: Codex
- 確認日: 2026-02-07
- 実施方法:
  - 静的確認（コード/ドキュメント照合）
  - 構文確認: `node --check js/script.js`
- 制約:
  - ブラウザ上の手動操作（実ファイル投入、画面遷移、Excel実出力の目視確認）は未実施

### 7.2 ステータス早見表

| 区分 | 実施済み（コード確認） | 手動確認済み | 手動確認待ち |
|---|---:|---:|---:|
| 実装要件（FR + NFR） | 19 | 0 | 5 |
| 受け入れ試験（UAT） | - | 0 | 14 |
| 要対応（未実装/不足） | 0 | - | - |

### 7.3 実施済み（コード確認）一覧

- FR-001 画面互換（主要ID存在）
- FR-002 ファイル読込（Excel/CSV + ステータス表示）
- FR-003 シフト解析（ヘッダー探索、定員解析、土日祝判定）
- FR-004 列認識（タグマッピング方式）
- FR-005 場所整合性検証
- FR-006 参加者生成
- FR-007 スロット生成
- FR-008 共通制約判定
- FR-009 ロジック選択（4ロジック）
- FR-010 結果表示（サマリー + 4タブ）
- FR-011 Excel出力（3シート）
- FR-013 不足タグナビ
- FR-014 マッピング確定
- FR-015 未対応列フィルタ
- FR-016 割当実行ボタン無効理由表示
- FR-017 D&D読込
- FR-018 前回マッピング自動復元（`localStorage`）
- FR-019 用語統一（主要表示語）
- NFR-002 可読性（構文エラーなし、基本記法維持）

### 7.4 手動確認一覧

- [ ] FR-012 削除禁止機能の実動作確認
- [ ] NFR-001 保守性
- [ ] NFR-003 性能
- [ ] NFR-004 信頼性
- [ ] NFR-005 デザイン互換
- [ ] UAT-01 機能同等（削除禁止機能が動作）
- [ ] UAT-02 主要フロー（読込→プレビュー→割当→4タブ→Excel出力）
- [ ] UAT-03 再割当（既存入力セル保持 + 空欄補完）
- [ ] UAT-04 複数人体制（展開/表示/出力一致）
- [ ] UAT-05 NG期間（0で無効、>0で有効）
- [ ] UAT-06 列認識（監査対象項目が意図どおり）
- [ ] UAT-07 出力整合（画面とExcelの集計一致）
- [ ] UAT-08 不足タグナビ（表示/移動/ハイライト）
- [ ] UAT-09 マッピング確定（確定前後の制御）
- [ ] UAT-10 未対応列フィルタ（ON/OFF/空状態）
- [ ] UAT-11 割当ボタン無効理由（表示/即時更新）
- [ ] UAT-12 D&D（読込成功/エラー/既存選択維持）
- [ ] UAT-13 自動復元（同形式復元/不一致抑止/本文未保存）
- [ ] UAT-14 用語統一（`tool.html` と `manual.html` 一致）

### 7.5 追加UXの実装状況（更新）

1. FR-013 不足タグナビ（`#mappingIssueNav`）
   - 判定: 実装済み（コード確認）
   - 備考: 不足/重複ナビ、クリック移動、行ハイライトを実装
2. FR-014 マッピング確定アクション（`#confirmMappingBtn`, `#mappingConfirmStatus`）
   - 判定: 実装済み（コード確認）
   - 備考: `isConfirmed` を開放条件に追加し、タグ変更時の再確定フローを実装
3. FR-015 未対応列のみ表示（`#showUnmappedOnly`）
   - 判定: 実装済み（コード確認）
   - 備考: `UNMAPPED` 絞り込みと未対応0件時の空状態表示を実装

### 7.6 証跡（コマンド）

```powershell
node --check js/script.js
rg -n "uploadSection|...|detailAnalysisTable|mappingRestoreNotice|restoreLastMappingBtn|assignBlockedReason" tool.html
rg -n "evaluateAssignmentReadiness|setupUploadDragAndDrop|LOCAL_STORAGE_MAPPING_KEY|buildMappingHeaderSignature|refreshMappingRestoreCandidate|restoreLastMappingFromStorage" js/script.js
rg -n "showUnmappedOnly|confirmMappingBtn|mappingConfirmStatus|mappingIssueNav|isConfirmed|unmappedOnly" js/script.js tool.html css/style.css
```
