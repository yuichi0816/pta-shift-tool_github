# PTA旗振りシフトツール 目的と機能まとめ

## このアプリの目的
本アプリは、PTAの「旗振り・挨拶当番」シフト作成業務を効率化するためのツール群です。  
アンケート回答とシフト表テンプレートを使い、希望条件に配慮した割当てを自動化し、確認・配布・運用（リマインド送信）までを一連で支援します。

## 主な機能

### 1. シフト自動割当て（`tool.html` / `js/script.js`）
- アンケート回答と「旗振りシフト日と場所」Excelを読み込み
- 希望条件（参加可能月・曜日・特定日・希望場所・回数上限）を考慮して自動割当て
- 「前後NG期間（日数）」で同一人物の連続割当てを抑制（0で無効）
- 既に入力済みの枠（手動確定済み）を保持したまま未入力枠のみ補完
- 地点名に `（N人体制）` を付けることで1地点複数人割当てに対応
- 割当てロジックを選択可能（全員最低1回保証 / 参加者優先 / 標準 / 日付順）

### 2. 結果確認・出力（`tool.html` / `js/script.js`）
- サマリー表示（参加者数、必要枠、割当て数、未割当て数、充足率）
- 結果タブ表示（シフト表、割当て集計、特定希望日集中度、詳細分析）
- Excel出力（シフト表、割り当て集計、詳細分析の複数シート）

### 3. データ検証・整形（`validator.html` / `js/validator.js`）
- アンケート生データのエラー/警告検出
- 代表的な検証: 氏名未入力、重複回答の可能性、希望回数の不正（未入力・0・数値抽出不可）、希望日形式不正
- 任意でシフト表を読み込み、希望場所名や日付の照合も実施
- 整形済みデータを `survey_cleaned_*.xlsx` として出力

### 4. リマインドメール運用支援（`gas-config.html` / `gas/reminder_email.gs`）
- GASスクリプト設定値（シート名、列、送信設定、件名・本文）をUIで生成
- 前日指定時刻での自動送信、送信ログ、二重送信防止、添付PDF対応
- シミュレーション関数・テスト送信関数を用意

### 5. 利用状況の地域分析（`region.html` / `functions/api/*`）
- 日別アクセスをKVに記録し、月単位で地域別表示
- 国内（都道府県名）/海外（国名）に分けて可視化
- CSVダウンロード、集計リセット（トークン認証付き）に対応

## 補足
- 主なシフト割当て処理はブラウザ内で完結します。
- 入出力の中心はExcel（`.xlsx`）です。
