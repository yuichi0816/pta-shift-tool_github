<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GASï¼ˆGoogle Apps Scriptï¼‰è¨­å®šãƒ„ãƒ¼ãƒ«</title>
    <meta name="description" content="ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¨­å®šã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš™ï¸</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 600px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #006837;
            box-shadow: 0 0 0 3px rgba(0, 104, 55, 0.1);
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Courier New', Consolas, monospace;
        }

        .form-hint {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
        }

        .code-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 500px;
            overflow-y: auto;
        }

        .code-output .keyword {
            color: #569cd6;
        }

        .code-output .string {
            color: #ce9178;
        }

        .code-output .number {
            color: #b5cea8;
        }

        .code-output .comment {
            color: #6a9955;
        }

        .copy-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: #006837;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #005530;
            transform: translateY(-1px);
        }

        .copy-btn.copied {
            background: #2e7d32;
        }

        .action-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .reset-btn {
            padding: 12px 24px;
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reset-btn:hover {
            background: #eee;
        }

        .section-divider {
            border-top: 1px solid #e0e0e0;
            margin: 24px 0;
            padding-top: 24px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #006837;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .preview-box {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }

        .preview-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
        }

        .email-preview {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 16px;
            font-size: 0.95rem;
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .variable-hint {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }

        .variable-hint code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Consolas, monospace;
        }
    </style>
</head>

<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <h1 class="logo"><span style="font-size: 1.5em;">âš™ï¸</span> Google Apps Script è¨­å®šãƒ„ãƒ¼ãƒ«</h1>
                <p class="tagline">GASï¼ˆGoogle Apps Scriptï¼‰ã§ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«ã‚’è‡ªå‹•é€ä¿¡</p>
                <div style="margin-top: 10px;">
                    <a href="index.html" style="color: white; text-decoration: underline; font-size: 0.9rem;">ğŸ  ãƒ›ãƒ¼ãƒ </a>
                    <span style="margin: 0 10px; color: rgba(255,255,255,0.5);">|</span>
                    <a href="tool.html" style="color: white; text-decoration: underline; font-size: 0.9rem;">ğŸ¯
                        ã‚·ãƒ•ãƒˆå‰²å½“ã¦</a>
                    <span style="margin: 0 10px; color: rgba(255,255,255,0.5);">|</span>
                    <a href="manual.html" style="color: white; text-decoration: underline; font-size: 0.9rem;">ğŸ“–
                        ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main container">
            <!-- Step 1: Sheet Settings -->
            <section class="card" id="sheetSection">
                <div class="card-header">
                    <span class="step-badge">STEP 1</span>
                    <h2>ã‚·ãƒ¼ãƒˆãƒ»åˆ—ã®è¨­å®š</h2>
                </div>
                <div class="card-body">
                    <div class="section-title">ğŸ“‹ ã‚·ãƒ¼ãƒˆå</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="shiftSheetName">ã‚·ãƒ•ãƒˆçµæœã‚·ãƒ¼ãƒˆå</label>
                            <input type="text" id="shiftSheetName" value="ã‚·ãƒ•ãƒˆçµæœ">
                        </div>
                        <div class="form-group">
                            <label for="surveySheetName">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”ã‚·ãƒ¼ãƒˆå</label>
                            <input type="text" id="surveySheetName" value="ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”">
                        </div>
                        <div class="form-group">
                            <label for="logSheetName">é€ä¿¡ãƒ­ã‚°ã‚·ãƒ¼ãƒˆå</label>
                            <input type="text" id="logSheetName" value="é€ä¿¡ãƒ­ã‚°">
                            <p class="form-hint">â€»è‡ªå‹•ä½œæˆã•ã‚Œã¾ã™</p>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="section-title">ğŸ“Š ã‚·ãƒ•ãƒˆçµæœã‚·ãƒ¼ãƒˆã®åˆ—è¨­å®š</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="shiftDateCol">æ—¥ä»˜ãŒå…¥ã£ã¦ã„ã‚‹åˆ—</label>
                            <select id="shiftDateCol"></select>
                        </div>
                        <div class="form-group">
                            <label for="shiftLocationStartCol">åœ°ç‚¹ã®é–‹å§‹åˆ—</label>
                            <select id="shiftLocationStartCol"></select>
                            <p class="form-hint">â€»çµ‚äº†åˆ—ã¯è‡ªå‹•æ¤œå‡ºã•ã‚Œã¾ã™</p>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="section-title">ğŸ“ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”ã‚·ãƒ¼ãƒˆã®åˆ—è¨­å®š</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="surveyEmailCol">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹åˆ—</label>
                            <select id="surveyEmailCol"></select>
                        </div>
                        <div class="form-group">
                            <label for="surveyNameCol">æ°ååˆ—</label>
                            <select id="surveyNameCol"></select>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 2: Send Settings -->
            <section class="card" id="sendSection">
                <div class="card-header">
                    <span class="step-badge">STEP 2</span>
                    <h2>é€ä¿¡è¨­å®š</h2>
                </div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="daysBefore">ä½•æ—¥å‰ã«ãƒªãƒã‚¤ãƒ³ãƒ‰</label>
                            <select id="daysBefore">
                                <option value="0">å½“æ—¥ï¼ˆ0æ—¥å‰ï¼‰</option>
                                <option value="1" selected>å‰æ—¥ï¼ˆ1æ—¥å‰ï¼‰</option>
                                <option value="2">2æ—¥å‰</option>
                                <option value="3">3æ—¥å‰</option>
                                <option value="7">1é€±é–“å‰ï¼ˆ7æ—¥å‰ï¼‰</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sendHour">é€ä¿¡æ™‚åˆ»ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰</label>
                            <select id="sendHour"></select>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 3: Email Settings -->
            <section class="card" id="emailSection">
                <div class="card-header">
                    <span class="step-badge">STEP 3</span>
                    <h2>ãƒ¡ãƒ¼ãƒ«è¨­å®š</h2>
                </div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="emailSubject">ãƒ¡ãƒ¼ãƒ«ä»¶å</label>
                            <input type="text" id="emailSubject" value="ã€ãƒªãƒã‚¤ãƒ³ãƒ‰ã€‘æ˜æ—¥ã¯æ——æŒ¯ã‚Šå½“ç•ªã§ã™">
                        </div>
                        <div class="form-group">
                            <label for="labelName">Gmailãƒ©ãƒ™ãƒ«å</label>
                            <input type="text" id="labelName" value="æ——æŒ¯ã‚Šãƒªãƒã‚¤ãƒ³ãƒ‰">
                        </div>
                        <div class="form-group">
                            <label for="attachmentFilename">æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆæœ«å°¾ä¸€è‡´ï¼‰</label>
                            <input type="text" id="attachmentFilename" value="æ——æŒ¯ã‚Šåœ°ç‚¹ã«ã¤ã„ã¦.pdf">
                            <p class="form-hint">â€»ç©ºæ¬„ã«ã™ã‚‹ã¨æ·»ä»˜ãªã—ã€‚ä¾‹: R7æ——æŒ¯ã‚Šåœ°ç‚¹ã«ã¤ã„ã¦.pdf, R8æ——æŒ¯ã‚Šåœ°ç‚¹ã«ã¤ã„ã¦.pdf ã«ãƒãƒƒãƒ</p>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="section-title">âœ‰ï¸ ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡</div>
                    <div class="variable-hint">
                        <strong>ä½¿ç”¨å¯èƒ½ãªå¤‰æ•°:</strong><br>
                        <code>{name}</code> â†’ æ‹…å½“è€…ã®æ°å<br>
                        <code>{date}</code> â†’ æ‹…å½“æ—¥ï¼ˆYYYY/MM/DDå½¢å¼ï¼‰<br>
                        <code>{location}</code> â†’ å ´æ‰€ï¼ˆåœ°ç‚¹åï¼‰
                    </div>
                    <div class="form-group">
                        <textarea id="emailBody">{name} æ§˜

æ˜æ—¥ã¯æ——æŒ¯ã‚Šå½“ç•ªã®æ—¥ã§ã™ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… æ—¥ä»˜: {date}
ğŸ“ å ´æ‰€: {location}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ãŠå¿™ã—ã„ã¨ã“ã‚æã‚Œå…¥ã‚Šã¾ã™ãŒã€
ã”å¯¾å¿œã®ã»ã©ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

â€»ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯è‡ªå‹•é€ä¿¡ã•ã‚Œã¦ã„ã¾ã™ã€‚
â€»ã”éƒ½åˆãŒæ‚ªããªã£ãŸå ´åˆã¯ã€PTAæ‹…å½“è€…ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚

--
PTAæ——æŒ¯ã‚Šã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </textarea>
                    </div>

                    <div class="preview-box">
                        <div class="preview-label">ğŸ“§ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§è¡¨ç¤ºï¼‰</div>
                        <div class="email-preview" id="emailPreview"></div>
                    </div>
                </div>
            </section>

            <!-- Step 4: Generate Code -->
            <section class="card" id="generateSection">
                <div class="card-header">
                    <span class="step-badge">STEP 4</span>
                    <h2>ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</h2>
                </div>
                <div class="card-body">
                    <p style="margin-bottom: 16px; color: #666;">
                        ä¸‹è¨˜ã®æ‰‹é †ã§Google Apps Scriptã«è¨­å®šã‚’é©ç”¨ã—ã¦ãã ã•ã„ï¼š
                    </p>
                    <ol style="margin-bottom: 20px; padding-left: 24px; color: #333; line-height: 1.8;">
                        <li>ã€Œã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                        <li>ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ã€Œã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã§ã‚³ãƒ”ãƒ¼</li>
                        <li>Apps Scriptã‚¨ãƒ‡ã‚£ã‚¿ã§ <code>reminder_email.gs</code> ã‚’é–‹ã</li>
                        <li><strong>æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¨ã¦å‰Šé™¤</strong>ï¼ˆCtrl+A â†’ Deleteï¼‰</li>
                        <li>ã‚³ãƒ”ãƒ¼ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ï¼ˆCtrl+Vï¼‰</li>
                        <li>ä¿å­˜ï¼ˆCtrl+Sï¼‰ã—ã¦å®Œäº†</li>
                    </ol>

                    <div class="action-row">
                        <button class="btn btn-primary" id="generateBtn" onclick="generateCode()">
                            ğŸ”§ ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
                        </button>
                        <button class="reset-btn" onclick="resetToDefaults()">
                            ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                        </button>
                    </div>

                    <div id="codeOutput" style="display: none; margin-top: 24px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span style="font-weight: 500; color: #333;">ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰:</span>
                            <button class="copy-btn" id="copyBtn" onclick="copyCode()">
                                ğŸ“‹ ã‚³ãƒ”ãƒ¼
                            </button>
                        </div>
                        <div class="code-output" id="generatedCode"></div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div style="margin-bottom: 12px;">
                <a href="contact.html"
                    style="color: rgba(255,255,255,0.9); text-decoration: none; font-weight: 500; font-size: 0.9rem; border-bottom: 1px dashed rgba(255,255,255,0.4);">
                    ğŸ“¨ ãŠå•ã„åˆã‚ã›
                </a>
            </div>
            <p>Â© 2025 åƒè‘‰çœŒæŸå°å­¦æ ¡PTA. All rights reserved.</p>
            <p>GASï¼ˆGoogle Apps Scriptï¼‰è¨­å®šãƒ„ãƒ¼ãƒ« ver.202602</p>
        </footer>
    </div>

    <script>
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
        const DEFAULTS = {
            shiftSheetName: 'ã‚·ãƒ•ãƒˆçµæœ',
            surveySheetName: 'ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”',
            logSheetName: 'é€ä¿¡ãƒ­ã‚°',
            shiftDateCol: 'A',
            shiftLocationStartCol: 'C',
            surveyEmailCol: 'B',
            surveyNameCol: 'N',
            daysBefore: '1',
            sendHour: '20',
            emailSubject: 'ã€ãƒªãƒã‚¤ãƒ³ãƒ‰ã€‘æ˜æ—¥ã¯æ——æŒ¯ã‚Šå½“ç•ªã§ã™',
            labelName: 'æ——æŒ¯ã‚Šãƒªãƒã‚¤ãƒ³ãƒ‰',
            attachmentFilename: 'æ——æŒ¯ã‚Šåœ°ç‚¹ã«ã¤ã„ã¦.pdf',
            emailBody: `{name} æ§˜

æ˜æ—¥ã¯æ——æŒ¯ã‚Šå½“ç•ªã®æ—¥ã§ã™ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… æ—¥ä»˜: {date}
ğŸ“ å ´æ‰€: {location}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ãŠå¿™ã—ã„ã¨ã“ã‚æã‚Œå…¥ã‚Šã¾ã™ãŒã€
ã”å¯¾å¿œã®ã»ã©ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

â€»ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯è‡ªå‹•é€ä¿¡ã•ã‚Œã¦ã„ã¾ã™ã€‚
â€»ã”éƒ½åˆãŒæ‚ªããªã£ãŸå ´åˆã¯ã€PTAæ‹…å½“è€…ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚

--
PTAæ——æŒ¯ã‚Šã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ `
        };

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initColumnSelects();
            initHourSelect();
            updateEmailPreview();

            // ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡å¤‰æ›´æ™‚ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
            document.getElementById('emailBody').addEventListener('input', updateEmailPreview);
        });

        // åˆ—é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
        function initColumnSelects() {
            const columns = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            const selects = ['shiftDateCol', 'shiftLocationStartCol', 'surveyEmailCol', 'surveyNameCol'];

            selects.forEach(id => {
                const select = document.getElementById(id);
                columns.forEach(col => {
                    const option = document.createElement('option');
                    option.value = col;
                    option.textContent = col + 'åˆ—';
                    select.appendChild(option);
                });
            });

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
            document.getElementById('shiftDateCol').value = DEFAULTS.shiftDateCol;
            document.getElementById('shiftLocationStartCol').value = DEFAULTS.shiftLocationStartCol;
            document.getElementById('surveyEmailCol').value = DEFAULTS.surveyEmailCol;
            document.getElementById('surveyNameCol').value = DEFAULTS.surveyNameCol;
        }

        // æ™‚åˆ»é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
        function initHourSelect() {
            const select = document.getElementById('sendHour');
            for (let hour = 0; hour < 24; hour++) {
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = `${hour}æ™‚`;
                if (hour === 20) option.selected = true;
                select.appendChild(option);
            }
        }

        // ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
        function updateEmailPreview() {
            const body = document.getElementById('emailBody').value;
            const preview = body
                .replace(/{name}/g, 'ç”°ä¸­å¤ªéƒ')
                .replace(/{date}/g, '2026/02/05')
                .replace(/{location}/g, 'æ­£é–€å‰äº¤å·®ç‚¹');
            document.getElementById('emailPreview').textContent = preview;
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
        function resetToDefaults() {
            document.getElementById('shiftSheetName').value = DEFAULTS.shiftSheetName;
            document.getElementById('surveySheetName').value = DEFAULTS.surveySheetName;
            document.getElementById('logSheetName').value = DEFAULTS.logSheetName;
            document.getElementById('shiftDateCol').value = DEFAULTS.shiftDateCol;
            document.getElementById('shiftLocationStartCol').value = DEFAULTS.shiftLocationStartCol;
            document.getElementById('surveyEmailCol').value = DEFAULTS.surveyEmailCol;
            document.getElementById('surveyNameCol').value = DEFAULTS.surveyNameCol;
            document.getElementById('daysBefore').value = DEFAULTS.daysBefore;
            document.getElementById('sendHour').value = DEFAULTS.sendHour;
            document.getElementById('emailSubject').value = DEFAULTS.emailSubject;
            document.getElementById('labelName').value = DEFAULTS.labelName;
            document.getElementById('attachmentFilename').value = DEFAULTS.attachmentFilename;
            document.getElementById('emailBody').value = DEFAULTS.emailBody;
            updateEmailPreview();
            document.getElementById('codeOutput').style.display = 'none';
        }

        // ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆå®Œå…¨ãªGASã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆï¼‰
        function generateCode() {
            const shiftSheetName = document.getElementById('shiftSheetName').value;
            const surveySheetName = document.getElementById('surveySheetName').value;
            const logSheetName = document.getElementById('logSheetName').value;
            const shiftDateCol = document.getElementById('shiftDateCol').value;
            const shiftLocationStartCol = document.getElementById('shiftLocationStartCol').value;
            const surveyEmailCol = document.getElementById('surveyEmailCol').value;
            const surveyNameCol = document.getElementById('surveyNameCol').value;
            const daysBefore = document.getElementById('daysBefore').value;
            const sendHour = document.getElementById('sendHour').value;
            const emailSubject = document.getElementById('emailSubject').value;
            const labelName = document.getElementById('labelName').value;
            const attachmentFilename = document.getElementById('attachmentFilename').value;
            const emailBody = document.getElementById('emailBody').value;

            // ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‚’GASãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«å½¢å¼ã«å¤‰æ›
            const bodyCode = emailBody
                .replace(/\\/g, '\\\\')
                .replace(/`/g, '\\`')
                .replace(/\$/g, '\\$')
                .replace(/{name}/g, '${assignment.name}')
                .replace(/{date}/g, '${assignment.date}')
                .replace(/{location}/g, '${assignment.location}');

            const code = `/**
 * PTAæ——æŒ¯ã‚Šã‚·ãƒ•ãƒˆ ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
 * 
 * ä½¿ã„æ–¹:
 * 1. ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®Apps Scriptã«ã‚³ãƒ”ãƒ¼
 * 2. ã€Œè¨­å®šã€ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ã€å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›
 * 3. sendRemindersé–¢æ•°ã‚’æ¯æ—¥å®Ÿè¡Œã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®š
 */

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘                    â˜… è¨­å®šã‚¨ãƒªã‚¢ â˜…                              â•‘
// â•‘  ã“ã“ã‚’ç’°å¢ƒã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ãã ã•ã„                            â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ã‚·ãƒ¼ãƒˆåã®è¨­å®š
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  SHIFT_SHEET_NAME: '${escapeString(shiftSheetName)}',       // ã‚·ãƒ•ãƒˆçµæœãŒå…¥ã£ã¦ã„ã‚‹ã‚·ãƒ¼ãƒˆå
  SURVEY_SHEET_NAME: '${escapeString(surveySheetName)}',   // ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”ãŒå…¥ã£ã¦ã„ã‚‹ã‚·ãƒ¼ãƒˆå
  LOG_SHEET_NAME: '${escapeString(logSheetName)}',            // é€ä¿¡ãƒ­ã‚°ã‚’è¨˜éŒ²ã™ã‚‹ã‚·ãƒ¼ãƒˆåï¼ˆè‡ªå‹•ä½œæˆï¼‰
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ã‚·ãƒ•ãƒˆçµæœã‚·ãƒ¼ãƒˆã®åˆ—è¨­å®šï¼ˆæ¨ªæŒã¡å½¢å¼ï¼‰
  // 
  // ä¾‹: | æ—¥ä»˜ | æ›œæ—¥ | åœ°ç‚¹A | åœ°ç‚¹B | åœ°ç‚¹C | ...
  //     | 2/5  | æœˆ   | ç”°ä¸­  | ä½è—¤  | å±±ç”°  | ...
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  SHIFT_DATE_COL: '${shiftDateCol}',              // æ—¥ä»˜ãŒå…¥ã£ã¦ã„ã‚‹åˆ—
  SHIFT_LOCATION_START_COL: '${shiftLocationStartCol}',    // åœ°ç‚¹ã®é–‹å§‹åˆ—
  // â€»åœ°ç‚¹ã®çµ‚äº†åˆ—ã¯è‡ªå‹•æ¤œå‡ºï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã®ç©ºã§ãªã„æœ€å¾Œã®åˆ—ã¾ã§ï¼‰
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”ã‚·ãƒ¼ãƒˆã®åˆ—è¨­å®š
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  SURVEY_EMAIL_COL: '${surveyEmailCol}',            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹åˆ—
  SURVEY_NAME_COL: '${surveyNameCol}',             // æ°ååˆ—
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // æ°åã®ç…§åˆè¨­å®š
  // 
  // ã‚·ãƒ•ãƒˆçµæœã®æ°åã«ã€Œ_2å¹´ã€ã‚„ã€Œ_4å¹´(2)ã€ã®ã‚ˆã†ãªã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒä»˜ã„ã¦ã„ã‚‹å ´åˆã€
  // ã“ã®æ­£è¦è¡¨ç¾ã§é™¤å»ã—ã¦ã‹ã‚‰ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”ã¨ç…§åˆã—ã¾ã™ã€‚
  // ä¾‹: ã€Œä½è—¤å¤ªéƒ_2å¹´ã€ã€Œä½è—¤å¤ªéƒ_4å¹´(2)ã€â†’ã€Œä½è—¤å¤ªéƒã€ã¨ã—ã¦ç…§åˆ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  NAME_SUFFIX_PATTERN: /_\\d+å¹´(\\(\\d+\\))?$/,  // _1å¹´, _2å¹´, _4å¹´(2) ãªã©ã«ãƒãƒƒãƒ
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  DAYS_BEFORE: ${daysBefore},                   // ä½•æ—¥å‰ã«ãƒªãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ã‹ï¼ˆ1=å‰æ—¥ï¼‰
  SEND_HOUR: ${sendHour},                    // ä½•æ™‚ã«é€ä¿¡ã™ã‚‹ã‹ï¼ˆ0-23ã€${sendHour}æ™‚ï¼‰
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ãƒ¡ãƒ¼ãƒ«è¨­å®š
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  SUBJECT: '${escapeString(emailSubject)}',
  LABEL_NAME: '${escapeString(labelName)}',   // Gmailã«ä»˜ã‘ã‚‹ãƒ©ãƒ™ãƒ«å
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š
  // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹PDFã‚’æ·»ä»˜
  // ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ«å°¾ãŒä¸€è‡´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
  // æ·»ä»˜ã—ãªã„å ´åˆã¯ '' ï¼ˆç©ºæ–‡å­—åˆ—ï¼‰ã«è¨­å®š
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ATTACHMENT_FILENAME: '${escapeString(attachmentFilename)}',
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// åˆ—åå¤‰æ›ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆAâ†’0, Bâ†’1, Câ†’2, ... AAâ†’26, ABâ†’27, ...ï¼‰
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function colToIndex(colLetter) {
  const col = colLetter.toUpperCase();
  let index = 0;
  for (let i = 0; i < col.length; i++) {
    index = index * 26 + (col.charCodeAt(i) - 64);
  }
  return index - 1; // 0å§‹ã¾ã‚Šã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å¤‰æ›
}

// ==================== ãƒ¡ã‚¤ãƒ³å‡¦ç† ====================

/**
 * ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°
 * ãƒˆãƒªã‚¬ãƒ¼ã‹ã‚‰ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™
 */
function sendReminders() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  
  // å„ã‚·ãƒ¼ãƒˆã‚’å–å¾—
  const shiftSheet = ss.getSheetByName(CONFIG.SHIFT_SHEET_NAME);
  const surveySheet = ss.getSheetByName(CONFIG.SURVEY_SHEET_NAME);
  let logSheet = ss.getSheetByName(CONFIG.LOG_SHEET_NAME);
  
  // ã‚·ãƒ¼ãƒˆã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
  if (!shiftSheet) {
    Logger.log('ã‚¨ãƒ©ãƒ¼: ã‚·ãƒ•ãƒˆçµæœã‚·ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    return;
  }
  if (!surveySheet) {
    Logger.log('ã‚¨ãƒ©ãƒ¼: ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”ã‚·ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    return;
  }
  
  // é€ä¿¡ãƒ­ã‚°ã‚·ãƒ¼ãƒˆãŒãªã‘ã‚Œã°ä½œæˆ
  if (!logSheet) {
    logSheet = createLogSheet(ss);
  }
  
  // æ˜æ—¥ã®æ—¥ä»˜ã‚’å–å¾—
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + CONFIG.DAYS_BEFORE);
  const tomorrowStr = formatDate(tomorrow);
  
  Logger.log(\`å¯¾è±¡æ—¥ä»˜: \${tomorrowStr}\`);
  
  // ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ˜æ—¥ã®æ‹…å½“è€…ã‚’æŠ½å‡º
  const assignments = getTomorrowAssignments(shiftSheet, tomorrow);
  Logger.log(\`æ˜æ—¥ã®æ‹…å½“è€…æ•°: \${assignments.length}\`);
  
  if (assignments.length === 0) {
    Logger.log('æ˜æ—¥ã®æ‹…å½“è€…ã¯ã„ã¾ã›ã‚“');
    return;
  }
  
  // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒƒãƒ—ã‚’ä½œæˆ
  const emailMap = createEmailMap(surveySheet);
  
  // ãƒ©ãƒ™ãƒ«ã‚’å–å¾—ã¾ãŸã¯ä½œæˆ
  const label = getOrCreateLabel(CONFIG.LABEL_NAME);
  
  // å„æ‹…å½“è€…ã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡
  let sentCount = 0;
  for (const assignment of assignments) {
    // ã‚·ãƒ•ãƒˆçµæœã®æ°åã‹ã‚‰ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’é™¤å»ã—ã¦ç…§åˆ
    const nameForLookup = stripNameSuffix(assignment.name);
    const email = emailMap[normalizeString(nameForLookup)];
    
    if (!email) {
      Logger.log(\`è­¦å‘Š: \${assignment.name} ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\`);
      logToSheet(logSheet, tomorrowStr, assignment.name, assignment.location, '', 'é€ä¿¡å¤±æ•—: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ä¸æ˜');
      continue;
    }
    
    // äºŒé‡é€ä¿¡ãƒã‚§ãƒƒã‚¯
    if (isAlreadySent(logSheet, tomorrowStr, email)) {
      Logger.log(\`ã‚¹ã‚­ãƒƒãƒ—: \${assignment.name} ã«ã¯æ—¢ã«é€ä¿¡æ¸ˆã¿\`);
      continue;
    }
    
    // ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    try {
      sendReminderEmail(email, assignment, label);
      logToSheet(logSheet, tomorrowStr, assignment.name, assignment.location, email, 'é€ä¿¡æˆåŠŸ');
      sentCount++;
      Logger.log(\`é€ä¿¡å®Œäº†: \${assignment.name} (\${email})\`);
    } catch (e) {
      Logger.log(\`ã‚¨ãƒ©ãƒ¼: \${assignment.name} ã¸ã®é€ä¿¡å¤±æ•— - \${e.message}\`);
      logToSheet(logSheet, tomorrowStr, assignment.name, assignment.location, email, \`é€ä¿¡å¤±æ•—: \${e.message}\`);
    }
  }
  
  Logger.log(\`é€ä¿¡å®Œäº†: \${sentCount}ä»¶\`);
}

// ==================== ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° ====================

/**
 * æ˜æ—¥ã®ã‚·ãƒ•ãƒˆæ‹…å½“è€…ã‚’å–å¾—ï¼ˆæ¨ªæŒã¡å½¢å¼å¯¾å¿œï¼‰
 * ã‚·ãƒ¼ãƒˆæ§‹é€ : Aåˆ—=æ—¥ä»˜, Båˆ—=æ›œæ—¥, Cåˆ—ä»¥é™=åœ°ç‚¹ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã«åœ°ç‚¹åï¼‰
 * åœ°ç‚¹ã®çµ‚äº†åˆ—ã¯ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‹ã‚‰è‡ªå‹•æ¤œå‡º
 */
function getTomorrowAssignments(sheet, targetDate) {
  const data = sheet.getDataRange().getValues();
  const assignments = [];
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‹ã‚‰åœ°ç‚¹åã‚’å–å¾—ï¼ˆç©ºã§ãªã„åˆ—ã¾ã§ï¼‰
  const headerRow = data[0];
  const locationNames = [];
  const startCol = colToIndex(CONFIG.SHIFT_LOCATION_START_COL);
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’èµ°æŸ»ã—ã¦åœ°ç‚¹ã‚’åé›†
  for (let col = startCol; col < headerRow.length; col++) {
    const cellValue = headerRow[col];
    if (cellValue && String(cellValue).trim()) {
      locationNames.push(String(cellValue).trim());
    } else {
      // ç©ºã‚»ãƒ«ã«åˆ°é”ã—ãŸã‚‰çµ‚äº†
      break;
    }
  }
  
  Logger.log(\`æ¤œå‡ºã—ãŸåœ°ç‚¹æ•°: \${locationNames.length} (\${locationNames.join(', ')})\`);
  
  // å„è¡Œã‚’ãƒã‚§ãƒƒã‚¯
  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    const dateValue = row[colToIndex(CONFIG.SHIFT_DATE_COL)];
    
    if (!dateValue) continue;
    
    // æ—¥ä»˜ã‚’æ¯”è¼ƒ
    const shiftDate = new Date(dateValue);
    if (isSameDate(shiftDate, targetDate)) {
      // ã“ã®æ—¥ä»˜ã®è¡Œã®å„åœ°ç‚¹ã‚’ãƒã‚§ãƒƒã‚¯
      for (let j = 0; j < locationNames.length; j++) {
        const col = startCol + j;
        const name = row[col];
        if (name && String(name).trim()) {
          // ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°åã„ã‚‹å ´åˆã¯åˆ†å‰²
          const names = String(name).split(/[,ã€]/);
          for (const n of names) {
            if (n.trim()) {
              assignments.push({
                date: formatDate(targetDate),
                location: locationNames[j],
                name: n.trim()
              });
            }
          }
        }
      }
      break; // å¯¾è±¡æ—¥ä»˜ãŒè¦‹ã¤ã‹ã£ãŸã‚‰ãƒ«ãƒ¼ãƒ—çµ‚äº†
    }
  }
  
  return assignments;
}

/**
 * ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒƒãƒ—ã‚’ä½œæˆï¼ˆæ°å -> ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰
 */
function createEmailMap(sheet) {
  const data = sheet.getDataRange().getValues();
  const map = {};
  
  for (let i = 1; i < data.length; i++) { // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
    const row = data[i];
    const email = row[colToIndex(CONFIG.SURVEY_EMAIL_COL)];
    const name = row[colToIndex(CONFIG.SURVEY_NAME_COL)];
    
    if (email && name) {
      map[normalizeString(name)] = email;
    }
  }
  
  return map;
}

/**
 * ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡
 */
function sendReminderEmail(email, assignment, label) {
  const body = \`
${bodyCode}
\`;

  // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
  const attachment = getAttachmentFile();
  
  // ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  const options = {};
  if (attachment) {
    options.attachments = [attachment];
  }
  
  // ãƒ¡ãƒ¼ãƒ«é€ä¿¡
  GmailApp.sendEmail(email, CONFIG.SUBJECT, body, options);
  
  // é€ä¿¡æ¸ˆã¿ãƒ¡ãƒ¼ãƒ«ã«ãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ã¦ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
  Utilities.sleep(2000); // é€ä¿¡ãŒå®Œäº†ã™ã‚‹ã¾ã§å°‘ã—å¾…æ©Ÿ
  
  const threads = GmailApp.search(\`to:\${email} subject:"\${CONFIG.SUBJECT}" newer_than:1d\`, 0, 1);
  if (threads.length > 0) {
    const thread = threads[0];
    thread.addLabel(label);
    thread.moveToArchive();
  }
}

/**
 * æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ï¼‰
 * ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ«å°¾ãŒä¸€è‡´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
 */
function getAttachmentFile() {
  // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«åãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
  if (!CONFIG.ATTACHMENT_FILENAME) {
    return null;
  }
  
  try {
    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®è¦ªãƒ•ã‚©ãƒ«ãƒ€ã‚’å–å¾—
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const ssFile = DriveApp.getFileById(ss.getId());
    const parents = ssFile.getParents();
    
    if (!parents.hasNext()) {
      Logger.log('è­¦å‘Š: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®è¦ªãƒ•ã‚©ãƒ«ãƒ€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      return null;
    }
    
    const folder = parents.next();
    
    // ãƒ•ã‚©ãƒ«ãƒ€å†…ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èµ°æŸ»ã—ã€æœ«å°¾ãŒä¸€è‡´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
    const allFiles = folder.getFiles();
    let foundFile = null;
    
    while (allFiles.hasNext()) {
      const file = allFiles.next();
      const fileName = file.getName();
      
      // ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ«å°¾ãŒè¨­å®šå€¤ã¨ä¸€è‡´ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      if (fileName.endsWith(CONFIG.ATTACHMENT_FILENAME)) {
        foundFile = file;
        break;
      }
    }
    
    if (!foundFile) {
      Logger.log(\`è­¦å‘Š: "*\${CONFIG.ATTACHMENT_FILENAME}" ã«ä¸€è‡´ã™ã‚‹æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\`);
      return null;
    }
    
    Logger.log(\`æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: \${foundFile.getName()}\`);
    return foundFile.getBlob();
    
  } catch (e) {
    Logger.log(\`æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼: \${e.message}\`);
    return null;
  }
}

/**
 * ãƒ©ãƒ™ãƒ«ã‚’å–å¾—ã¾ãŸã¯ä½œæˆ
 */
function getOrCreateLabel(labelName) {
  let label = GmailApp.getUserLabelByName(labelName);
  if (!label) {
    label = GmailApp.createLabel(labelName);
  }
  return label;
}

/**
 * é€ä¿¡ãƒ­ã‚°ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ
 */
function createLogSheet(ss) {
  const sheet = ss.insertSheet(CONFIG.LOG_SHEET_NAME);
  sheet.appendRow(['é€ä¿¡æ—¥æ™‚', 'æ‹…å½“æ—¥', 'æ‹…å½“è€…å', 'å ´æ‰€', 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹']);
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã®æ›¸å¼è¨­å®š
  const headerRange = sheet.getRange(1, 1, 1, 6);
  headerRange.setBackground('#4a86e8');
  headerRange.setFontColor('white');
  headerRange.setFontWeight('bold');
  
  return sheet;
}

/**
 * é€ä¿¡ãƒ­ã‚°ã«è¨˜éŒ²
 */
function logToSheet(sheet, targetDate, name, location, email, status) {
  sheet.appendRow([
    new Date(),
    targetDate,
    name,
    location,
    email,
    status
  ]);
}

/**
 * æ—¢ã«é€ä¿¡æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
 */
function isAlreadySent(sheet, targetDate, email) {
  const data = sheet.getDataRange().getValues();
  
  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    if (row[1] === targetDate && row[4] === email && row[5] === 'é€ä¿¡æˆåŠŸ') {
      return true;
    }
  }
  
  return false;
}

/**
 * æ—¥ä»˜ã‚’YYYY/MM/DDå½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
 */
function formatDate(date) {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return \`\${year}/\${month}/\${day}\`;
}

/**
 * åŒã˜æ—¥ä»˜ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
 */
function isSameDate(date1, date2) {
  return date1.getFullYear() === date2.getFullYear() &&
         date1.getMonth() === date2.getMonth() &&
         date1.getDate() === date2.getDate();
}

/**
 * æ°åã‹ã‚‰ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆ_2å¹´ãªã©ï¼‰ã‚’é™¤å»
 * CONFIG.NAME_SUFFIX_PATTERN ã«è¨­å®šã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨
 */
function stripNameSuffix(name) {
  if (!name) return '';
  return String(name).replace(CONFIG.NAME_SUFFIX_PATTERN, '');
}

/**
 * æ–‡å­—åˆ—ã‚’æ­£è¦åŒ–ï¼ˆç©ºç™½å‰Šé™¤ã€å…¨è§’åŠè§’çµ±ä¸€ï¼‰
 */
function normalizeString(str) {
  if (!str) return '';
  return String(str)
    .trim()
    .replace(/\\s+/g, '')
    .replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));
}

// ==================== ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–¢æ•° ====================

/**
 * æ¯æ—¥ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®š
 */
function createDailyTrigger() {
  // æ—¢å­˜ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’å‰Šé™¤
  const triggers = ScriptApp.getProjectTriggers();
  for (const trigger of triggers) {
    if (trigger.getHandlerFunction() === 'sendReminders') {
      ScriptApp.deleteTrigger(trigger);
    }
  }
  
  // æ–°ã—ã„ãƒˆãƒªã‚¬ãƒ¼ã‚’ä½œæˆ
  ScriptApp.newTrigger('sendReminders')
    .timeBased()
    .atHour(CONFIG.SEND_HOUR)
    .everyDays(1)
    .create();
  
  Logger.log(\`ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ: æ¯æ—¥ \${CONFIG.SEND_HOUR}æ™‚ã«å®Ÿè¡Œ\`);
}

/**
 * ğŸ—‘ï¸ æ¯æ—¥ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’å‰Šé™¤ï¼ˆè‡ªå‹•é€ä¿¡ã‚’åœæ­¢ï¼‰
 */
function deleteDailyTrigger() {
  const triggers = ScriptApp.getProjectTriggers();
  let deletedCount = 0;
  
  for (const trigger of triggers) {
    if (trigger.getHandlerFunction() === 'sendReminders') {
      ScriptApp.deleteTrigger(trigger);
      deletedCount++;
    }
  }
  
  if (deletedCount > 0) {
    Logger.log(\`\${deletedCount}ä»¶ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚è‡ªå‹•é€ä¿¡ã¯åœæ­¢ã•ã‚Œã¾ã—ãŸã€‚\`);
  } else {
    Logger.log('å‰Šé™¤ã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
  }
}

/**
 * ãƒ†ã‚¹ãƒˆé€ä¿¡ï¼ˆä»Šæ—¥ã®æ‹…å½“è€…ã«ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰
 */
function testSendReminders() {
  // è¨­å®šã‚’ä¸€æ™‚çš„ã«å¤‰æ›´ã—ã¦ãƒ†ã‚¹ãƒˆ
  CONFIG.DAYS_BEFORE = 0; // ä»Šæ—¥ã®æ‹…å½“è€…ã‚’å¯¾è±¡
  sendReminders();
}

// ==================== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ====================

/**
 * ğŸ” ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã—ï¼‰
 * 
 * å®Ÿéš›ã«ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã›ãšã«ã€ä»¥ä¸‹ã‚’ç¢ºèªã§ãã¾ã™ï¼š
 * - ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Š
 * - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç…§åˆ
 * - é€ä¿¡å¯¾è±¡è€…ã®ä¸€è¦§
 * 
 * çµæœã¯ã€Œè¡¨ç¤ºã€â†’ã€Œãƒ­ã‚°ã€ã§ç¢ºèªã—ã¦ãã ã•ã„
 */
function simulateReminders() {
  simulateForDate(CONFIG.DAYS_BEFORE);
}

/**
 * ğŸ” ç‰¹å®šæ—¥ä»˜ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
 * @param {number} daysFromToday - ä»Šæ—¥ã‹ã‚‰ä½•æ—¥å¾Œï¼ˆ0=ä»Šæ—¥ã€1=æ˜æ—¥ã€-1=æ˜¨æ—¥ï¼‰
 */
function simulateForDate(daysFromToday) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  
  Logger.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  Logger.log('ğŸ“§ ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ« ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã—ï¼‰');
  Logger.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  
  // ã‚·ãƒ¼ãƒˆã‚’å–å¾—
  const shiftSheet = ss.getSheetByName(CONFIG.SHIFT_SHEET_NAME);
  const surveySheet = ss.getSheetByName(CONFIG.SURVEY_SHEET_NAME);
  
  if (!shiftSheet) {
    Logger.log(\`âŒ ã‚¨ãƒ©ãƒ¼: "\${CONFIG.SHIFT_SHEET_NAME}" ã‚·ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\`);
    return;
  }
  if (!surveySheet) {
    Logger.log(\`âŒ ã‚¨ãƒ©ãƒ¼: "\${CONFIG.SURVEY_SHEET_NAME}" ã‚·ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\`);
    return;
  }
  
  Logger.log(\`âœ… ã‚·ãƒ•ãƒˆçµæœã‚·ãƒ¼ãƒˆ: \${CONFIG.SHIFT_SHEET_NAME}\`);
  Logger.log(\`âœ… ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”ã‚·ãƒ¼ãƒˆ: \${CONFIG.SURVEY_SHEET_NAME}\`);
  
  // å¯¾è±¡æ—¥ä»˜ã‚’è¨ˆç®—
  const targetDate = new Date();
  targetDate.setDate(targetDate.getDate() + daysFromToday);
  const targetDateStr = formatDate(targetDate);
  
  Logger.log('');
  Logger.log(\`ğŸ“… å¯¾è±¡æ—¥ä»˜: \${targetDateStr}ï¼ˆä»Šæ—¥ã‹ã‚‰\${daysFromToday}æ—¥å¾Œï¼‰\`);
  Logger.log('');
  
  // ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ‹…å½“è€…ã‚’æŠ½å‡º
  const assignments = getTomorrowAssignments(shiftSheet, targetDate);
  
  if (assignments.length === 0) {
    Logger.log('âš ï¸ ã“ã®æ—¥ã®æ‹…å½“è€…ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
    return;
  }
  
  Logger.log(\`ğŸ‘¥ æ‹…å½“è€…æ•°: \${assignments.length}äºº\`);
  Logger.log('');
  
  // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒƒãƒ—ã‚’ä½œæˆ
  const emailMap = createEmailMap(surveySheet);
  Logger.log(\`ğŸ“‹ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”ã‹ã‚‰å–å¾—ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ•°: \${Object.keys(emailMap).length}ä»¶\`);
  Logger.log('');
  
  // å„æ‹…å½“è€…ã®ç…§åˆçµæœã‚’è¡¨ç¤º
  Logger.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
  Logger.log('ç…§åˆçµæœ:');
  Logger.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
  
  let matchCount = 0;
  let noMatchCount = 0;
  
  for (const assignment of assignments) {
    const originalName = assignment.name;
    const nameForLookup = stripNameSuffix(originalName);
    const normalizedName = normalizeString(nameForLookup);
    const email = emailMap[normalizedName];
    
    if (email) {
      Logger.log(\`âœ… \${originalName}\`);
      Logger.log(\`   â†’ ç…§åˆå: "\${nameForLookup}" â†’ ãƒ¡ãƒ¼ãƒ«: \${email}\`);
      Logger.log(\`   â†’ å ´æ‰€: \${assignment.location}\`);
      matchCount++;
    } else {
      Logger.log(\`âŒ \${originalName}\`);
      Logger.log(\`   â†’ ç…§åˆå: "\${nameForLookup}" â†’ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ä¸æ˜\`);
      Logger.log(\`   â†’ å ´æ‰€: \${assignment.location}\`);
      noMatchCount++;
    }
    Logger.log('');
  }
  
  // ã‚µãƒãƒªãƒ¼
  Logger.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  Logger.log('ğŸ“Š ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã‚µãƒãƒªãƒ¼');
  Logger.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  Logger.log(\`å¯¾è±¡æ—¥ä»˜: \${targetDateStr}\`);
  Logger.log(\`æ‹…å½“è€…æ•°: \${assignments.length}äºº\`);
  Logger.log(\`  âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¯èƒ½: \${matchCount}äºº\`);
  Logger.log(\`  âŒ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ä¸æ˜: \${noMatchCount}äºº\`);
  Logger.log('');
  Logger.log('â€» ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãƒ¡ãƒ¼ãƒ«ã¯é€ä¿¡ã•ã‚Œã¦ã„ã¾ã›ã‚“');
  Logger.log('â€» çµæœã‚’ç¢ºèªå¾Œã€å•é¡Œãªã‘ã‚Œã° createDailyTrigger() ã§ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„');
}

/**
 * ğŸ” æ˜æ—¥ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
 */
function simulateTomorrow() {
  simulateForDate(1);
}

/**
 * ğŸ” ä»Šæ—¥ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
 */
function simulateToday() {
  simulateForDate(0);
}
`;

            document.getElementById('generatedCode').textContent = code;
            document.getElementById('codeOutput').style.display = 'block';

            // ç”Ÿæˆå¾Œã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('codeOutput').scrollIntoView({ behavior: 'smooth' });
        }

        // æ–‡å­—åˆ—ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        function escapeString(str) {
            return str.replace(/\\/g, '\\\\').replace(/'/g, "\\'");
        }

        // ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
        function copyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼';
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
            });
        }
    </script>
</body>

</html>